<!doctype html>
<html lang="de" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-robotik/speedControl" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Ein Integralregler für die Geschwindigkeit | Rule The Bots</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://spacehal.github.io/docs/robotik/speedControl"><meta data-rh="true" name="docusaurus_locale" content="de"><meta data-rh="true" name="docsearch:language" content="de"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ein Integralregler für die Geschwindigkeit | Rule The Bots"><meta data-rh="true" name="description" content="Mit einem Integralregler und Rad-Encodern wird die Geschwindigkeit des Zumo 32u4 Roboters geregelt."><meta data-rh="true" property="og:description" content="Mit einem Integralregler und Rad-Encodern wird die Geschwindigkeit des Zumo 32u4 Roboters geregelt."><meta data-rh="true" name="keywords" content="Arduino,Roboter,Robotik,Gesschwindigkeit regeln,Quadraturencoder,Inkrementalgeber,Radencoder,Motorencoder,Integralregler,Integral-Regler,I-Regler,Zumo 32u4"><link data-rh="true" rel="icon" href="/img/LogoSmallRed.svg"><link data-rh="true" rel="canonical" href="https://spacehal.github.io/docs/robotik/speedControl"><link data-rh="true" rel="alternate" href="https://spacehal.github.io/docs/robotik/speedControl" hreflang="de"><link data-rh="true" rel="alternate" href="https://spacehal.github.io/docs/robotik/speedControl" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TBHHG3V4Z4-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Rule The Bots" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.d12aea83.css">
<link rel="preload" href="/assets/js/runtime~main.5ef0a3da.js" as="script">
<link rel="preload" href="/assets/js/main.4a8e95d1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Zum Hauptinhalt springen"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Zum Hauptinhalt springen</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">RuleTheBots</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/arduino/helloworld">Arduino</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/robotik/beginning">Robotik</a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/zumo32u4/gettingStarted">Zumo32u4</a><a class="navbar__item navbar__link" href="/docs/more/links">Links</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Suche"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Suche</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Zurück nach oben scrollen" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_ToTc themedImage--dark_i4oU"><b>RuleTheBots</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/arduino">Arduino</a><button aria-label="Umschalten der Seitenleiste mit einklappbarer Kategorie &#x27;Arduino&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/robotik/beginning">Roboter</a><button aria-label="Umschalten der Seitenleiste mit einklappbarer Kategorie &#x27;Roboter&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linienfolger">Linienfolger</a><button aria-label="Umschalten der Seitenleiste mit einklappbarer Kategorie &#x27;Linienfolger&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/motorencoder">Motorencoder</a><button aria-label="Umschalten der Seitenleiste mit einklappbarer Kategorie &#x27;Motorencoder&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/robotik/wheelEncoder">Motorencoder</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/robotik/goStraight">Ge­ra­de­aus­fahrt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/robotik/speedControl">Geschwindigkeitsregler</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/lokalisierung">Lokalisierung</a><button aria-label="Umschalten der Seitenleiste mit einklappbarer Kategorie &#x27;Lokalisierung&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/projekte">Projekte</a><button aria-label="Umschalten der Seitenleiste mit einklappbarer Kategorie &#x27;Projekte&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/zumo-32u4">Zumo 32u4</a><button aria-label="Umschalten der Seitenleiste mit einklappbarer Kategorie &#x27;Zumo 32u4&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Seitenleiste einklappen" aria-label="Seitenleiste einklappen" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/robotik/beginning"><span itemprop="name">Roboter</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/motorencoder"><span itemprop="name">Motorencoder</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Geschwindigkeitsregler</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Auf dieser Seite</button></div><div class="theme-doc-markdown markdown"><header><h1>Ein Integralregler für die Geschwindigkeit</h1></header><p>Mit den <a href="/docs/robotik/wheelEncoder">Motor-Encodern</a> kann der Roboter nicht nur <a href="/docs/robotik/goStraight">geradeaus fahren</a> oder eine <a href="/docs/robotik/wheelEncoder#aufgaben">festgelegte Distanz</a> zurücklegen, sondern er kann auch verwendet werden, die Geschwindigkeit des Roboters zu regeln. </p><p>Ohne Geschwindigkeitsregelung würde zum Beispiel ein fester PWM-Wert für den Motor bei abnehmender Batteriespannung zu einem langsamer fahrenden Roboter führen. Mit Regler kann jedoch der Motorwert so angepasst werden, dass der Roboter konstant mit der vorgegebenen Geschwindigkeit fährt.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="geschwindigkeit-messen">Geschwindigkeit messen<a href="#geschwindigkeit-messen" class="hash-link" aria-label="Direkter Link zur Geschwindigkeit messen" title="Direkter Link zur Geschwindigkeit messen">​</a></h2><p>Bevor ein Regler für die Geschwindigkeit vorgestellt wird, soll die aktuelle Geschwindigkeit des Roboters über die serielle Schnittstelle ausgegeben werden, um sie anschließend mit einem geeignetem Program als Liniendiagramm darzustellen zu können.</p><p>Zum Bestimmen der Geschwindigkeit des Roboters, müssen für ein festes Zeitintervall <code>dZeit</code> die vom linken und rechten Motor erzeugten Encoder-Impulse ermittelt und anschließend gemittelt werden:</p><div class="language-arduino codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-arduino codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> impulseLinks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encoders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCountsAndResetRight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Impulse auslesen und zurücksetzen</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> impulseRechts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encoders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCountsAndResetLeft</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impulseRoboter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">impulseLinks </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> impulseRechts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Mittelwert bestimmen</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Die Geschwindigkeit des Roboters <code>vRoboter</code> wird dann in <em>Encoderimpulse pro Sekunde</em> angegeben.</p><div class="language-arduino codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-arduino codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> vRoboter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> impulseRoboter</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dZeit</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Robotergeschwindigkeit in Impulsen pro Sekunde</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Würde die Geschwindigkeit so oft wie möglich, also mit einem möglichst kleinem <code>dZeit</code> bestimmt werden, so würden die sich ergebenden Werte ziemlich <strong>stark schwanken</strong>. Diese <strong>Quantisierungsfehler</strong> entstehen, wenn pro Zeitintervall nur sehr wenige Encoderimpulse gemessen werden. Wird dann in einem Zeitintervall nur ein Impuls mehr oder weniger gezählt, führt das zu einer relativ großen Änderung der ermittelten Geschwindigkeit.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="beispiel">Beispiel<a href="#beispiel" class="hash-link" aria-label="Direkter Link zur Beispiel" title="Direkter Link zur Beispiel">​</a></h4><p>In einem <strong>Zeitintervall von 4 ms</strong> werden 9 bzw. 10 Impulse gezählt. Wird für beide Fälle die Geschwindigkeit bestimmt, so ergeben sich folgende Geschwindigkeiten:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> 9  Impulse in 4 ms  -&gt;   2250 Impulse pro Sekunde</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10  Impulse in 4 ms  -&gt;   2500 Impulse pro Sekunde</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> Das ergibt eine Abweichung von 10 %. Wird das Zeitintervall vergrößert, wird die prozentuale Abweichung immer kleiner, und die ermittelte Geschwindigkeit schwankt daher weniger. Das Zeitintervall, in welchem die Encoder-Impulse bestimmt werden, sollte so festgelegt sein, dass im Mittel ca. 50 Impulse detektiert werden.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="zeitverlauf-der-geschwindigkeit">Zeitverlauf der Geschwindigkeit<a href="#zeitverlauf-der-geschwindigkeit" class="hash-link" aria-label="Direkter Link zur Zeitverlauf der Geschwindigkeit" title="Direkter Link zur Zeitverlauf der Geschwindigkeit">​</a></h3><div class="chartwrapper"><canvas role="img" height="45" width="100"></canvas></div><p>In der Abbildung ist der Verlauf der Geschwindigkeit des Zumo 32u4 dargestellt, wenn er aus dem Stand auf den Motorwert <code>setSpeeds(300,300)</code> beschleunigt. Es ist gut zu erkennen, dass die Geschwindigkeit relativ schnell stark ansteigt und dann ab ca. 160 ms die Maximalgeschwindigkeit erreicht.</p><details class="details_lb9f alert alert--info details_b_Ee ueben" data-collapsed="true"><summary>Aufgaben</summary><div><div class="collapsibleContent_i85q"> <ol><li><p>Beschreiben Sie weitere Situationen, in denen es sinnvoll ist die Motordrehzahl zu regeln.</p></li><li><p>Lassen Sie den Roboter über eine Zeit von ca. 0,5 Sekunden mit verschiedenen Geschwindigkeiten (200, 300, 400) fahren. Bestimmen sie gleichzeitig die <strong>aktuelle Geschwindigkeit in Impulsen pro Sekunde</strong>.<br>
<!-- -->Geben Sie sowohl die Zeit als auch die Geschwindigkeit während des Beschleunigungsvorgangs auf dem seriellen Monitor aus.<br>
<!-- -->Stellen Sie abschließend ihr Ergebnisse mit einem geeignetem Programm (z.B. <a href="https://support.microsoft.com/de-de/topic/darstellen-von-daten-im-punkt-oder-liniendiagramm-4570a80f-599a-4d6b-a155-104a9018b86e#OfficeVersion=Windows" target="_blank" rel="noopener noreferrer">Excel</a> oder Openoffice) graphisch dar (y-Achse: Impulse pro Sekunde, x-Achse: Zeit in Millisekunden) und beantworten Sie folgende Fragen:  </p><ol><li>Wie lange benötigt der Roboter, bis er seine jeweilige Maximalgeschwindigkeit erreicht hat?</li><li>Welcher (mathematischer) Funktionstyp beschreibt den Zusammenhang zwischen Zeit und Geschwindigkeit am besten.   </li></ol><p><strong>Hinweise</strong> für die Bearbeitung</p><ul><li><p>Nutzen Sie für eine bessere Genauigkeit bei der Zeitmessung die <a href="https://www.arduino.cc/reference/de/language/functions/time/micros/" target="_blank" rel="noopener noreferrer"><code>micros()</code></a> Funktion. Beachten Sie aber, das die <strong>Geschwindigkeit in Impulsen pro Sekunde</strong> und nicht in Impulsen pro Mikrosekunde angegeben werden soll.</p></li><li><p>Trennen sie beide Werte mit einem Tabulator (<code>\t</code>):  </p><div class="language-arduino codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-arduino codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">Serial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zeit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">Serial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;\t&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token builtin">Serial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vRoboter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Messen Sie die Geschwindigkeit in einem Zeitintervall, welches im Mittel ca. 50 Impulse detektiert (ca. 20 ms).  </p></li><li><p>Verwenden Sie den Programmauszug:</p><div class="language-arduino codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-arduino codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/*   Programmauszug zur Geschwindigkeitsmessung    */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*  ...  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> dZeit    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Zeitintervall für die Geschwindigkeitsmessung (5000 Mikrosekunden)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> fahrzeit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Dauer der Messung (0,5 Sekunden)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> jetzt         </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">micros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> startzeit     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jetzt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Startzeitpunkt der Messreihe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> letzteMessung </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jetzt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Zeitpunkt der letzten durchgeführten Messung</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jetzt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">micros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">// vergangene Zeit in Microsekunden</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">motors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setSpeeds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MOTORPOWER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MOTORPOWER</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jetzt </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startzeit </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> fahrzeit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// Roboter soll `fahrzeit` fahren</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  jetzt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">micros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// vergangene Zeit in Microsekunden</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jetzt </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> letzteMessung </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> dZeit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Zeitintervall zur Geschwindigkeitsmessung</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    letzteMessung </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jetzt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> impulseRight </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encoders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCountsAndResetRight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Impulse auslesen und zurücksetzen</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> impulseLinks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encoders</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getCountsAndResetLeft</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*  ...  */</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*  ...  */</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ol></div></div></details><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vorbetrachtungen-zum-regler">Vorbetrachtungen zum Regler<a href="#vorbetrachtungen-zum-regler" class="hash-link" aria-label="Direkter Link zur Vorbetrachtungen zum Regler" title="Direkter Link zur Vorbetrachtungen zum Regler">​</a></h2><p>Aber wie würde nun ein Regler für die Geschwindigkeit aussehen? Vom Linienfolger ist bereits der <a href="/docs/robotik/edge_P_Control#proportional-regler-p-controller">Proportionalregler</a> bekannt. Angenommen, der Roboter soll mit einer Geschwindigkeit von 2000 Encoder-Impulsen pro Sekunde fahren. Dann würde sich die Regelabweichung (also der Fehler) wie folgt berechnen:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fehler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> vRoboter     </span><span class="token comment" style="color:#999988;font-style:italic">// Fehler: Abweichung der Geschwindigkeit vom Sollwert</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Mit dem <a href="/docs/robotik/edge_P_Control#proportional-regler-p-controller">Proportionalregler</a> würde dann das Motorsignal für die <code>setSpeeds()</code>-Funktion bestimmt werden:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">motorSignal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> kp </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> fehler           </span><span class="token comment" style="color:#999988;font-style:italic">// P-Regler für das Motorsignal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setSpeeds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">motorSignal</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">motorSignal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// einstellen der Geschwindigkeit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Für den Fall, dass der Roboter sich mit der Sollgeschwindigkeit von 2000 Impulsen pro Sekunde bewegen würde, würde sich für den Fehler der Wert <code>fehler = 0</code> ergeben. Dadurch ergibt sich auch  für das Motorsignal der Wert <code>motorSignal = 0</code>. Der Roboter würde also stehen bleiben. </p><p>Ein Proportional-Regler, der das Motorsignal einfach nur proportional zum Fehler bestimmt, ist somit zur Regelung der Geschwindigkeit ungeeignet.</p><p>Ebenfalls ist der <a href="/docs/robotik/lineFollowerPD#differential-anteil">Differential-Regler</a> ungeeignet, da er nur auf Änderungen des Fehlers eingeht. Steht der Roboter einfach nur still, so ändert sich der Fehler nicht und es würde sich für das Motorsignal nur der Wert 0 ergeben.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="integralregler">Integralregler<a href="#integralregler" class="hash-link" aria-label="Direkter Link zur Integralregler" title="Direkter Link zur Integralregler">​</a></h2><p>Ein weiterer, bisher nicht besprochener Regler ist der Integralregler. Der Integralregler (I-Regler) ändert die Stellgröße nicht proportional zum Fehler wie der Proportionalregler oder in Abhängigkeit von der Änderung des Fehlers wie der Differentialregler, sondern basierend auf <strong>der Summe (oder dem Integral) der vorhergehenden Fehler</strong>. </p><p>Aus mathematischer Sicht entspricht diese Summe der Fehler dem Integral der Fehler <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span> über die Zeit <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span></span></span></span></span>.</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><mi>e</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mtext> d</mtext><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≈</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mtext> </mtext><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi><mo>+</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mtext> </mtext><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi><mo>+</mo><mo>⋯</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo>⋯</mo><mtext> </mtext><mo stretchy="false">)</mo><mtext> </mtext><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \int_{0}^{t} e(t) \text{ d}t &amp;\approx e(t_0)\ \cdot \Delta t + e(t_1)\ \cdot \Delta t + \cdots \\ &amp;= ( e(t_0) + e(t_1) + \cdots )\ \Delta t \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.2554em;vertical-align:-1.8777em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3777em"><span style="top:-4.3777em"><span class="pstrut" style="height:3.5435em"></span><span class="mord"><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5435em"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span><span style="top:-3.8129em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord text"><span class="mord"> d</span></span><span class="mord mathnormal">t</span></span></span><span style="top:-2.3258em"><span class="pstrut" style="height:3.5435em"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8777em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3777em"><span style="top:-4.3777em"><span class="pstrut" style="height:3.5435em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="minner">⋯</span></span></span><span style="top:-2.3258em"><span class="pstrut" style="height:3.5435em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mclose">)</span><span class="mspace"> </span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8777em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>Für den Pseudocode kann das Integral mit Hilfe der einzelnen Summen <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">e(t_i)\cdot \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></span> berechnet werden. Zu jedem neuen Zeitpunkt wird zu dem bereits berechneten Integral-Wert der neue Fehler <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">e(t_i)\cdot \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span></span> hinzuaddiert. Dadurch wird aus dem  komplizierten Integral eine sehr einfache Addition:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">integral </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> integral </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> fehler </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> dTime </span><span class="token comment" style="color:#999988;font-style:italic">// Aufsummieren der Fehler zum Integralanteil</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Der Integralanteil wird zu einer einfachen Summe, wenn bei <strong>konstanten Zeitintervallen</strong> die Multiplikation mit <code>dTime</code> weggelassen wird:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">integral </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> integral </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> fehler         </span><span class="token comment" style="color:#999988;font-style:italic">// Aufaddieren des Fehlers liefert den Integralanteil</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Zur Regelung der Motorgeschwindigkeit wird der Integral-Anteil, ähnlich wie der Proportional-Anteil, mit einem Faktor <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> gewichtet. Damit ergibt sich der folgende <strong>Pseudocode für den Integralregler</strong> :</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Pseudocode eines Integralreglers für die Geschwindigkeit //</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fehler      </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> vRoboter        </span><span class="token comment" style="color:#999988;font-style:italic">// Fehler: Abweichung der Geschwindigkeit vom Sollwert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">integral    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> integral </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> fehler      </span><span class="token comment" style="color:#999988;font-style:italic">// Aufsummieren der Fehler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">motorSignal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> integral </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> ki          </span><span class="token comment" style="color:#999988;font-style:italic">// Integralanteil mit Faktor ki wichten</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setSpeeds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">motorSignal</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">motorSignal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// einstellen der Geschwindigkeit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="integralanteil-beschränken---der-windup-effekt">Integralanteil beschränken - Der Windup-Effekt<a href="#integralanteil-beschränken---der-windup-effekt" class="hash-link" aria-label="Direkter Link zur Integralanteil beschränken - Der Windup-Effekt" title="Direkter Link zur Integralanteil beschränken - Der Windup-Effekt">​</a></h3><p>Wenn bei mit einem Integralregler die Sollgröße, also hier die Geschwindigkeit, nicht oder nur sehr langsam erreicht werden kann, so führt das zu einem stark ansteigenden Integralanteil. Dieser Effekt wird <em>Windup-Effket</em> genannt und kann unter anderem zu einer verlangsamten Regelgeschwindigkeit des Reglers führen. </p><p>Aus diesem Grund sollte der Integralanteil immer auf sinnvolle Werte begrenzt werden. Die Wahl der Grenzen für den Integralanteil hängt dabei auch vom gewählten Faktor <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> ab.</p><p>Für den  Geschwindigkeitsregeler mit <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">k_i=0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.1</span></span></span></span></span> und maximalen Motorwerten von <code>400</code> ist die Begrenzung des Integralanteils auf <code>-4000 ... +4000</code> sinnvoll:</p><div class="language-arduino codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-arduino codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">integral </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">constrain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integral</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="beispiel-geschwindigkeitsregelung">Beispiel Geschwindigkeitsregelung<a href="#beispiel-geschwindigkeitsregelung" class="hash-link" aria-label="Direkter Link zur Beispiel Geschwindigkeitsregelung" title="Direkter Link zur Beispiel Geschwindigkeitsregelung">​</a></h3><p>Ein Roboter soll mit einer <strong>Geschwindigkeit von 2000 Impulse pro Sekunde</strong> fahren. Hierfür wird ein Integralregler mit <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">k_i= 0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.1</span></span></span></span></span> verwendet. Der verwendete Regler hat keinen weiteren P-Anteil oder D-Anteil.</p><div class="chartwrapper"><canvas role="img" height="60" width="100"></canvas></div><p>In der Abbildung ist der Verlauf der  Werte für die Geschwindigkeit, den Fehler, den Integralanteil und das Motorsignal dargestellt. Die einzelnen Größen können in der Legende ein- oder ausgeblendet werden. </p><p>Um zu erklären, wie der Integralregler genau funktioniert, sind in der Tabelle die Werte für die ersten 5 Zeitpunkte des Reglers noch einmal aufgelistet.</p><div class="centerTab"><table><thead><tr><th align="left">#</th><th align="center">Zeit <!-- -->[ms]</th><th align="right">Geschwindigkeit</th><th align="right">Fehler</th><th align="right">Integralanteil</th><th align="right">Motorsignal</th></tr></thead><tbody><tr><td align="left">1.</td><td align="center">10</td><td align="right">0</td><td align="right">2000</td><td align="right">2000</td><td align="right">200</td></tr><tr><td align="left">2.</td><td align="center">20</td><td align="right">349</td><td align="right">1651</td><td align="right">3651</td><td align="right">365</td></tr><tr><td align="left">3.</td><td align="center">30</td><td align="right">1150</td><td align="right">850</td><td align="right">4000</td><td align="right">400</td></tr><tr><td align="left">4.</td><td align="center">40</td><td align="right">1750</td><td align="right">250</td><td align="right">4000</td><td align="right">400</td></tr><tr><td align="left">5.</td><td align="center">50</td><td align="right">2250</td><td align="right">-250</td><td align="right">3750</td><td align="right">375</td></tr></tbody></table></div><p>Bei der <strong>1. Messung</strong> ist die Geschwindigkeit des Roboters noch <code>vRoboter = 0</code>. Mit der angenommenen Sollgeschwindigkeit von <code>2000</code> ergibt sich ein Fehlerwert von <code>fehler = 2000</code>. Da der Integralanteil anfangs <code>0</code> war, ist nach der 1. Messung der Integralanteil <code>integral = 2000</code> und für das Motorsignal ergibt sich mit <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">k_i=0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.1</span></span></span></span></span> der Wert <code>motorSignal = 200</code>. Der Roboter fängt an, sich langsam zu bewegen.</p><p>Bei der <strong>2.Messung</strong> erkennt der Regler, dass der Roboter bereits eine Geschwindigkeit von <code>vRoboter = 349</code> hat und ermittelt mit <code>fehler = 1651</code> den neuen Integralanteil: </p><div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">integral =  2000 + 1651 = 3651</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Dies führt zu einem ansteigenden Motorwert von <code>motorSignal = 365</code>.  </p><p>Bei der <strong>3. Messung</strong> ermittelt der Regler bereits eine Geschwindigkeit von <code>vRoboter = 1150</code> und damit einen Fehler von <code>fehler = 850</code>. Würde der Fehler einfach zu dem alten Integralanteil hinzuaddiert werden, würde sich ein Wert von <code>integral = 4501</code> ergeben, was zu <code>motorSignal = 450</code> führen würde. Da der Integralanteil aber auf einen Maximalwert von <code>+4000</code> begrenzt sein soll, bestimmt der Regler nach der 3. Messung den Wert <code>integral = 4000</code>. (<em>Bei dem Roboter Zumo 32u4 ist der maximale Motorwert <code>400</code></em>)</p><p>Bei der darauffolgenden <strong>4. Messung</strong> hat sich der Roboter der Sollgeschwindigkeit bereits bis auf <code>fehler = 250</code> genähert. Da der Integralanteil begrenzt wird, bleibt dieser trotzdem auf dem Wert <code>integral = 4000</code>. Das Motorsignal bleibt ebenfalls gleich (<code>motorSignal = 400</code>).</p><p>Im nächsten Schritt, der <strong>5. Messung</strong>, überschreitet der Roboter erstmals die Sollgeschwindigkeit (<code>vRoboter = 2250</code>) und der Fehler nimmt einen negativen Wert an <code>fehler = -250</code>. Durch den negativen Fehler wird nun auch der Integralanteil reduziert (<code>integral = 3750</code>) und das Motorsignal wird auf <code>motorSignal = 375</code> verringert. Dadurch wird der Roboter wieder ein wenig langsamer.</p><p>In den nun folgenden Schritten pendelt die Geschwindigkeit noch etwas um den geforderten Sollwert herum, nähert sich diesem aber letztlich immer mehr an.</p><details class="details_lb9f alert alert--info details_b_Ee ueben" data-collapsed="true"><summary>Aufgaben</summary><div><div class="collapsibleContent_i85q"> <ol><li>Erläutern Sie, warum für den Geschwindkeitsregler eine Begrenzung des Integralanteils auf <code>-4000</code> bis <code>+4000</code> sinvoll ist. Wie würde sich der Regler in dem Beispiel verhalten, wenn der Integralanteil nicht beschränkt wäre?</li></ol></div></div></details><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pseudocode">Pseudocode<a href="#pseudocode" class="hash-link" aria-label="Direkter Link zur Pseudocode" title="Direkter Link zur Pseudocode">​</a></h3><p>Vollständiger Pseudocode für den I-Regler zum Regeln der Geschwindigkeit</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vSoll </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain">                            </span><span class="token comment" style="color:#999988;font-style:italic">// Sollwert der Geschwindigkeit in Impulsen pro Sekunde</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ki        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token plain">                         </span><span class="token comment" style="color:#999988;font-style:italic">// Integral-Faktor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">integral  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic">// Startwert für Integral-Anteil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wiederhole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vRoboter     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bestimmeV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// ermitteln der aktuellen Geschwindigkeit mit den Motorencodern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fehler       </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vSoll </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> vRoboter     </span><span class="token comment" style="color:#999988;font-style:italic">// Fehlerwert, Regeldifferenz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    integral     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> integral </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> fehler    </span><span class="token comment" style="color:#999988;font-style:italic">// Integral-Anteil </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    integral     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">begrenze</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integral</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Integralanteil begrenzen                                                   </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    motorSignal  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> integral </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> ki        </span><span class="token comment" style="color:#999988;font-style:italic">// Motorsignal bestimmen</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setMotors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">motorSignal</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">motorSignal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Aktualisieren der Motordrehzahlen</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><details class="details_lb9f alert alert--info details_b_Ee ueben" data-collapsed="true"><summary>Aufgaben</summary><div><div class="collapsibleContent_i85q"> <ol><li><p>Untersuchen Sie, welchen Einfluss die Begrenzung des Integralanteils auf das Verhalten eines Integralreglers für die Geschwindigkeit hat. Schreiben Sie dazu einen Integral-Regler, welcher die Geschwindigkeit des Roboters regelt.  </p><p>Geben Sie den Verlauf der <strong>Geschwindigkeit</strong>, des <strong>Fehler</strong>, des <strong>Integral-Anteil</strong> und des <strong>Motorsignal</strong> dem seriellen Monitor aus. Stellen Sie die Werte mit einem geeigneten Programm als Liniendiagramm dar.  </p><p>Analysieren Sie das Verhalten mit und ohne Begrenzung des Integralanteils und verschiedenen Werten für <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>. Welchen Einfluss hat der Wert <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> auf das Verhalten des Reglers. Welcher Wert führt zu einem Regelverhalten, welches mit wenigen Oszillationen schnell zum erreichen der Sollgeschwindigkeit führt.</p></li><li><p>Erweitern Sie die Geschwindigkeitsregelung (mit Begrenzung des Integralanteils) aus der letzten Aufgabe um folgende Eigenschaften:</p><ol><li>Die Sollgeschwindigkeit soll mit den Tastern A und B eingestellt werden können.</li><li>Auf dem Display wird der aktuelle Wert für das Motorsignal (Wert für die Funktion <code>setSpeeds()</code>) angezeigt.</li><li>Der Roboter soll erkennen, wenn er gegen ein Hindernis fährt und es mit der roten LED anzeigen.</li><li>Der Roboter folgt einer Linie mit der vorgegeben Geschwindigkeit.</li></ol></li></ol></div></div></details></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Dokumentation Seiten"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/robotik/goStraight"><div class="pagination-nav__sublabel">Zurück</div><div class="pagination-nav__label">Ge­ra­de­aus­fahrt</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/lokalisierung"><div class="pagination-nav__sublabel">Weiter</div><div class="pagination-nav__label">Lokalisierung</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#geschwindigkeit-messen" class="table-of-contents__link toc-highlight">Geschwindigkeit messen</a><ul><li><a href="#zeitverlauf-der-geschwindigkeit" class="table-of-contents__link toc-highlight">Zeitverlauf der Geschwindigkeit</a></li></ul></li><li><a href="#vorbetrachtungen-zum-regler" class="table-of-contents__link toc-highlight">Vorbetrachtungen zum Regler</a></li><li><a href="#integralregler" class="table-of-contents__link toc-highlight">Integralregler</a><ul><li><a href="#integralanteil-beschränken---der-windup-effekt" class="table-of-contents__link toc-highlight">Integralanteil beschränken - Der Windup-Effekt</a></li><li><a href="#beispiel-geschwindigkeitsregelung" class="table-of-contents__link toc-highlight">Beispiel Geschwindigkeitsregelung</a></li><li><a href="#pseudocode" class="table-of-contents__link toc-highlight">Pseudocode</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/SpaceHal/spacehal.github.io/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Schule</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.osztiem.de/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OSZTIEM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.arduino.cc/reference/de/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Arduino<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/impressum">Impressum</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Stefan Warm. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5ef0a3da.js"></script>
<script src="/assets/js/main.4a8e95d1.js"></script>
</body>
</html>